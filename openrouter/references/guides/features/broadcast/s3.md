---
title: Broadcast to S3
description: Send OpenRouter traces to Amazon S3 or S3-compatible storage
---

# Broadcast to S3 / S3-Compatible Storage

Amazon S3 is a scalable object storage service. OpenRouter can send traces to any S3-compatible storage, including AWS S3, Cloudflare R2, MinIO, and other compatible services.

## Setup

### Step 1: Create S3 Bucket and Credentials

#### AWS S3

1. Create an S3 bucket in your AWS account
2. Create an IAM user with programmatic access
3. Attach a policy that allows `s3:PutObject` on your bucket
4. Copy the **Access Key ID** and **Secret Access Key**

#### Cloudflare R2

1. Create an R2 bucket in the Cloudflare dashboard
2. Navigate to **R2 > Manage R2 API Tokens**
3. Generate a token with write permissions
4. Copy the **Access Key ID** and **Secret Access Key**
5. Obtain your account's S3 endpoint URL (format: `https://your-account-id.r2.cloudflarestorage.com`)

### Step 2: Enable Broadcast

Navigate to **Settings > Observability** in OpenRouter and toggle **Enable Broadcast**.

### Step 3: Configure S3 Destination

Add S3 as a destination and provide the following configuration:

| Field | Required | Description |
|---|---|---|
| **Bucket Name** | Yes | Storage destination identifier |
| **Region** | No | Geographic location (optional for some providers) |
| **Custom Endpoint** | No | Required for non-AWS S3-compatible services (e.g., Cloudflare R2, MinIO) |
| **Access Key Id** | Yes | Authentication credential |
| **Secret Access Key** | Yes | Authentication credential |
| **Session Token** | No | For temporary credential support |
| **Path Template** | No | Customizable storage organization using template variables. Default: `openrouter-traces/{date}` |

### Step 4: Test Connection

Click **Test Connection** to verify the setup. Configuration saves only upon successful validation.

### Step 5: Verify Traces

Send an API request through OpenRouter and verify the trace file appears in your bucket.

## Trace File Organization

Each trace is saved as a separate JSON file with the format `{traceId}-{timestamp}.json`.

### Path Template Variables

Customize how trace files are organized using these variables:

| Variable | Description |
|---|---|
| `{prefix}` | Custom prefix string |
| `{date}` | Date in YYYY-MM-DD format |
| `{year}` | Four-digit year |
| `{month}` | Two-digit month |
| `{day}` | Two-digit day |
| `{apiKeyName}` | Name of the API key used |

### Path Template Examples

| Template | Description |
|---|---|
| `openrouter-traces/{date}` | Default organization by date |
| `traces/{year}/{month}/{day}` | Hierarchical date organization |
| `{apiKeyName}/{date}` | Organized by API key name |
| `production/llm-traces/{date}` | Environment-based organization |

## Custom Metadata

Enrich your traces with custom metadata by including the `trace` field in your API requests:

```json
{
  "model": "openai/gpt-4o",
  "messages": [{ "role": "user", "content": "Analyze this document..." }],
  "user": "user_12345",
  "session_id": "session_abc",
  "trace": {
    "trace_name": "Document Analysis",
    "generation_name": "Extract Key Points",
    "document_type": "contract",
    "batch_id": "batch_456"
  }
}
```

### Metadata Mapping

| Key | S3 JSON Mapping | Description |
|---|---|---|
| `trace_id` | `id` (trace level) | Custom trace identifier |
| `trace_name` | `name` (trace level) | Custom name for the trace |
| `span_name` | `name` (observation level) | Name for intermediate spans |
| `generation_name` | `name` (observation level) | Name for the LLM generation |

Additional fields:

- `user` maps to `userId` in the stored JSON
- `session_id` maps to `sessionId` in the stored JSON
- Extra metadata keys in `trace` are preserved in the trace files

### Querying Stored Traces

You can analyze stored traces using SQL query tools like AWS Athena:

```sql
-- Example Athena query on S3 trace files
SELECT
  json_extract_scalar(metadata, '$.document_type') as doc_type,
  json_extract_scalar(metadata, '$.batch_id') as batch_id
FROM openrouter_traces
WHERE json_extract_scalar(metadata, '$.document_type') = 'contract';
```

## Privacy Mode

When Privacy Mode is enabled for this destination, prompt and completion content is excluded from traces. Token usage, costs, timing, and metadata remain in the stored trace files.
